%%$Id: notebook.sty,v 1.5 1999/05/05 16:10:22 paulh Exp $

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%
%% Copyright (c) 1996-1999 Wolfram Research, Inc.  All rights reserved.  
%% Distribution of this file is permitted without express consent of 
%% Wolfram Research; however, this file may only be used in conjunction
%% with files generated by Mathematica. Mathematica. is a registered
%% trademark of Wolfram Research, Inc.
%%
%% notebook.sty:  TeX and LaTeX macro file for the Mathematica 
%%    TeXSave command.  Look for updates of this file on MathSource.
%%    Since this macro file can be updated by Wolfram Research, Inc.,
%%    it is advised to not make any changes to this document.  If you
%%    would like to add or modify something in this macro file, it is
%%    suggested that you make a new .tex or .sty file, named testnotebook.sty
%%    for this example, and at the top of the testnotebook.sty put the line:
%%        \input notebook.sty
%%    Below this line should be where you make additions or modifications
%%    to the macros or settings defined in the original notebook.sty.
%%    To use the newly created macro file, testnotebook.sty in your .tex file
%%    change the default output of TeXSave from:
%%              \documentstyle[notebook]{article}
%%              \begin{document}
%%    to:  (For LaTeX)
%%              \documentstyle[testnotebook]{article}
%%              \begin{document}
%%    to:  (For plain TeX)
%%              \input testnotebook.sty
%%         and change the \end{document} at the end of the file to \end.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\long\def\wriifundefined#1#2#3{\expandafter\ifx\csname
  #1\endcsname\relax#2\else#3\fi}

\newif\iflatexversion

\wriifundefined{LaTeX}
{%%%%%%  Set flag for plain TeX %%%%%%
  \global\latexversionfalse%
  \gdef\makeatletter{\catcode`\@=11\relax}%
  \gdef\makeatother{\catcode`\@=12\relax}%
}{%%%%%  Set flag for LaTeX %%%%%%
  \global\latexversiontrue%
}

\makeatletter%

%%%%  These \if's need to be defined outside of the main
%%%%  \if below.

\newif\ifsecnum    
\newif\ifsubsecnum
\newif\if@firstamp %% Can't be nested in \if

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%  Inhibit paragraph indents like in Default 
%%  Style of FE notebooks and add a little space
%%  between paragraphs
\parindent 0pt \parskip 6pt
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\iflatexversion%%%%%  MACRO DEFINITIONS FOR LaTeX 2.09
  \message{(LaTeX format used)}
  \let\setspacetoken\relax
  \wriifundefined{Title}{\long\def\Title#1{\title{#1}\author{}\maketitle}}{}
  \wriifundefined{Subtitle}{\long\def\Subtitle#1{{\par\parindent 0pt\Large\bf\boldmath #1\par}}}{}
  \wriifundefined{Subsubtitle}{\long\def\Subsubtitle#1{{\par\parindent 0pt\large #1\par}}}{}
  \let\Section\section
  \let\Subsection\subsection
  \let\Subsubsection\subsubsection
  \def\Subsubsubsection#1{\vskip .5\baselineskip plus .25\baslineskip minus .25\baselineskip%
                 \noindent{\bf #1}\par}
  \def\wriboldmath{\boldmath}
  \def\SmallText#1{{\small #1}}
  \def\Abstract#1{\begin{abstract}#1\end{abstract}}
  \def\Address#1{\begin{quote}\em #1\end{quote}}
  \def\IndentedText#1{\begin{quote}#1\end{quote}}
  \def\Copyright#1{\vskip 12pt{\footnotesize #1}\vskip 12pt}
  \def\Note#1{\vskip 12pt{\fboxsep=6pt%
     \fbox{\vbox{\advance\hsize-12pt #1}}}\vskip 12pt}

  \def\dispTFNumberedEquationmath#1{
	\begin{equation}
	#1
	\end{equation}}
\def\dispSFNumberedEquationmath#1{{\mathversion{mono}%
	\begin{equation}
	#1
	\end{equation}}}
\else  %%%%%%  MACRO DEFINITIONS FOR PLAIN TeX.
  \message{(plain TeX format used)}
  \def\dispTFNumberedEquationmath#1{
	$$
	#1
	$$}
\def\dispSFNumberedEquationmath#1{{%\mathversion{mono}%
	$$
	#1
	$$}}
  \newbox\@tempboxa
  \newbox\@arstrutbox
  \newcount\@chclass
  \newcount\@lastchclass
  \newcount\@chnum
  \newcount\@tempcnta
  \newcount\@tempcntb
  \newcount\secnum
  \newcount\subsecnum
  \newdimen\arraycolsep
  \newdimen\tabcolsep
  \newdimen\arrayrulewidth
  \newdimen\doublerulesep
  \arraycolsep 5pt \tabcolsep 6pt \arrayrulewidth .4pt \doublerulesep 2pt 
  \let\wriboldmath\relax
  \def\frac#1#2{{#1\over #2}}
  \let\cal\relax
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% HEADING MACROS %%%%%%%%%%%%%%%%%%%%%%
  \wriifundefined{Title}{\long\def\Title#1{\hbox to \hsize{\hss\bf #1\hss}\vskip 24pt}}{}
  \wriifundefined{Subtitle}{\long\def\Subtitle#1{\hbox to \hsize{\hss\it #1\hss}\vskip 12pt}}{}
  \wriifundefined{Subsubtitle}{\long\def\Subsubtitle#1{\hbox to \hsize{\hss #1\hss}\vskip 12pt}}{}
  \wriifundefined{Section}{\def\Section{\@ifstar{\secnumfalse\doSection}{\secnumtrue\doSection}}
  \def\doSection#1{\vskip 12pt plus 3pt minus 3pt%
    \noindent{\bf%
    	\ifsecnum\global\advance\secnum by 1\the\secnum.\ \fi
    #1}\vskip 6pt}}{}
  \wriifundefined{Subsection}{\def\Subsection{\@ifstar{\subsecnumfalse\doSubsection}
						 {\subsecnumtrue\doSubsection}}
  \def\doSubsection#1{\vskip 12pt plus 3pt minus 3pt%
	\noindent{\bf\ifsubsecnum\global\advance\subsecnum by 1%
		\the\secnum.\the\subsecnum\ \fi #1}\vskip 6pt}}{}
  \wriifundefined{Subsubsection}{%
  \def\Subsubsection{\@ifstar{\doSubsubsection}{\doSubsubsection}}
  \def\doSubsubsection#1{\vskip 12pt plus 3pt minus 3pt%
		\noindent{\bf #1}\vskip 6pt plus 3pt minus 3pt}}{}
  \wriifundefined{Subsubsubsection}{\def\doSubsubsubsection#1{%
	\vskip 6pt plus 3pt minus 3pt\noindent{\bf #1}\par}}{}
  \def\SmallText#1{#1}
  \def\Abstract#1{%
    \par\vskip 12pt{\leftskip 12pt\rightskip 12pt #1\par}\vskip 12pt}
  \def\Address#1{%
    \par\vskip 12pt{\leftskip 12pt\rightskip 12pt\it #1\par}\vskip 12pt}
  \def\IndentedText#1{%
    \par\vskip 12pt{\leftskip 12pt\rightskip 12pt #1\par}\vskip 12pt}
  \let\Note\IndentedText
  \def\Copyright#1{\vskip 12pt #1\vskip 12pt}
%%%%%%%%%%%%%%%% NEEDED MathArray ENVIRONMENT DEFS %%%%%%%%%%%%%%%%%%%%%%%%%
  \def\arraystretch{1}    % Default value.
  \def\@nnil{\@nil}
  \def\@empty{}
  \def\@fornoop#1\@@#2#3{}
  \def\@addamp{\if@firstamp \@firstampfalse \else 
    \edef\@preamble{\@preamble &}\fi}
  \def\@arrayacol{\edef\@preamble{\@preamble \hskip \arraycolsep}}
  \def\@tabacol{\edef\@preamble{\@preamble \hskip \tabcolsep}}
  \def\@ampacol{\@addamp \@acol}
  \def\@acolampacol{\@acol\@addamp\@acol}
  \def\@arstrut{\relax\ifmmode\copy\@arstrutbox\else\unhcopy\@arstrutbox\fi}
%%%%%%%%%%%%%%%  SOME HANDY LaTeX DEFINITIONS  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  \def\@ifnextchar#1#2#3{\let\@tempe#1\def\@tempa{#2}%
      \def\@tempb{#3}\futurelet\@tempc\@ifnch}
  \def\@ifnch{\ifx \@tempc \@sptoken \let\@tempd\@xifnch
      \else \ifx \@tempc \@tempe\let\@tempd\@tempa\else\let\@tempd\@tempb\fi
      \fi \@tempd}
  \def\@ifstar#1#2{\@ifnextchar *{\def\@tempa*{#1}\@tempa}{#2}}
  \def\vspace{\@ifstar{\@vspacer}{\@vspace}}
  \def\@vspace#1{\ifvmode 
    \dimen@\prevdepth \expandafter\vskip #1\vskip \z@\prevdepth\dimen@
       \else 
        \@bsphack\vadjust{\dimen@\prevdepth 
            \expandafter\vskip #1\vskip \z@\prevdepth\dimen@}\@esphack\fi}
  \def\@vspacer#1{\ifvmode \dimen@\prevdepth 
         \hrule height\z@ \nobreak \expandafter\vskip #1\vskip \z@
           \prevdepth\dimen@
        \else
         \@bsphack\vadjust{\dimen@\prevdepth \hrule height\z@ \nobreak 
            \expandafter\vskip #1\vskip \z@ \prevdepth\dimen@}\@esphack\fi}
  \def\hspace{\protect\phspace}
  \def\phspace{\@ifstar{\@hspacer}{\@hspace}}
  \def\@hspace#1{\leavevmode\expandafter\hskip #1\relax}
  \def\@hspacer#1{\leavevmode\vrule width\z@\nobreak\expandafter\hskip 
                #1\hskip \z@\relax}  
  \def\rule{\@ifnextchar[{\@rule}{\@rule[0pt]}}
  \newdimen\@tempdima
  \def\@rule[#1]#2#3{\@tempdima#3\advance\@tempdima #1\leavevmode\hbox{\vrule
    width #2 height\@tempdima depth -#1}}
%%%%%%%%%%%%%%  Maybe remove this %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  \def\makebox{\@ifnextchar ({\@makepicbox}{\@ifnextchar
     [{\@makebox}{\mbox}}}
  \def\mbox#1{\leavevmode\hbox{#1}}
\def\@makebox[#1]{\leavevmode\@ifnextchar [{\@imakebox[#1]}{\@imakebox[#1][x]}}
  \long\def\@imakebox[#1][#2]#3{\hbox to#1{\let\mb@l\hss
  \let\mb@r\hss \expandafter\let\csname mb@#2\endcsname\relax
  \mb@l #3\mb@r}}
  \def\@makepicbox(#1,#2){\leavevmode\@ifnextchar 
    [{\@imakepicbox(#1,#2)}{\@imakepicbox(#1,#2)[]}}
  \long\def\@imakepicbox(#1,#2)[#3]#4{\vbox to#2\unitlength
   {\let\mb@b\vss \let\mb@l\hss\let\mb@r\hss
    \let\mb@t\vss
    \@tfor\@tempa :=#3\do{\expandafter\let
        \csname mb@\@tempa\endcsname\relax}%
   \mb@t\hbox to #1\unitlength{\mb@l #4\mb@r}\mb@b}}
   \gdef\setspacetoken{\global\let\@sptoken= }
   \def\:{\let\@sptoken= } \:  % this makes \@sptoken a space token
   \def\:{\@xifnch} \expandafter\def\: {\futurelet\@tempc\@ifnch}
   \let\small\relax
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\fi


\def\Author#1{{\parindent 0pt\it #1\par}\vskip 12pt}
\def\Caption#1{\setbox0=\hbox{\small\bf #1}%
  \ifdim\wd0 < .75\hsize\relax
     {\parindent 0pt\leftskip 0pt plus 1fill\rightskip 0pt plus 1fill%
     \leavevmode\box0\par}
  \else 
     {\parindent 0pt\leftskip 18pt\rightskip 18pt\leavevmode%
     \vbox{\hsize=.75\hsize\small\bf #1\par}\par}
  \fi\vskip 12pt}
\let\Commentary\Address
\let\Definition\Address
\let\Example\Address
\let\Exercise\Address
\let\ExerciseMain\Address
\let\ExerciseText\Address
\let\Theorem\Address
\def\ItemizedText#1{\vskip-\lastskip\vskip 6pt%
    \setbox0=\hbox{$\bullet$\kern 6pt}%
    \hangindent\wd0\hangafter=1 $\bullet$\kern 6pt #1\vskip 6pt}
\let\ItemizedTextNote\IndentedText
\let\MathCaption\ItemizedText
\def\Program#1{\vskip 12pt{\parindent 0pt\mv{#1}\par}\vskip 12pt}
\def\Reference#1{\vskip-\lastskip\vskip 6pt%
    \hangindent 12pt\hangafter=1 #1\vskip 6pt}
\def\TextTop#1{\vskip 12pt\leavevmode\vtop{#1\par}\vskip 12pt}

\overfullrule=0pt

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Modified version of the LaTeX array environment that
%% allows the array break across pages.  
%% LaTeX users may want to uncomment the following lines
%% and move them to the end of the file so that LaTeX's array
%% macro is used instead.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\let\MathBegin\begin
%\let\MathEnd\end
%\let\MathArray\array
%\let\endMathArray\endarray
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newbox\Mathbox     % This box holds the array vbox
\gdef\MathBegin#1{\def\tempa{\csname #1\endcsname}\tempa}
\gdef\MathEnd#1{\csname end#1\endcsname%
	\ifallowmathbreak\splitmathbox\global\allowmathbreakfalse%
	\else\ignorespaces\fi}

\iflatexversion
	\def\center{\par\begingroup\trivlist \centering\item[]}
	\def\endcenter{\endtrivlist\endgroup\par}
\else
	\def\center{\par\begingroup\parindent 0pt%
		\rightskip 0pt plus 1fill\leftskip 0pt plus 1fill\relax}
	\def\endcenter{\par\endgroup\par}
\fi

\newdimen\mathboxvar \mathboxvar=0pt
\def\splitmathbox{\dimen1=\ht\Mathbox 
    \ifdim\pagetotal < .9\pagegoal \advance\dimen1 by \pagetotal \fi
    \advance\dimen1 2.5\baselineskip 
    \ifdim\dimen1 < \vsize            % make sure it will fit on this page
        \vtop{\unvbox\Mathbox}
    \else                             % figure out how much will fit
                                      % on this page and print rest
        \dimen3=\pagegoal \advance\dimen3 by -\pagetotal%
        \ifpromptbreak\advance\dimen3 by -\baselineskip\fi%
	\advance\dimen3\mathboxvar
        \global\setbox0=\vsplit\Mathbox to \dimen3%
        \vtop{\unvbox0}\hfill\break%
		\loop                 %    while 2 columns are bigger than a page do
			\dimen0=\ht\Mathbox
			\ifdim\dimen0 > \textheight
				\dimen0=\textheight
				\global\setbox0=\vsplit\Mathbox to \dimen0
				\box0\hfill\break%
		\repeat
		\box\Mathbox%
    \fi}

\newif\ifallowmathbreak \allowmathbreakfalse
\def\MathArray{\@writabarray}
\def\@wriarrayacol{\edef\@preamble{\@preamble \hskip \arraycolsep}}

\def\@wriarrayclassz{\ifcase \@lastchclass \@acolampacol \or \@ampacol \or
   \or \or \@addamp \or
   \@acolampacol \or \@firstampfalse \@acol \fi
\edef\@preamble{\@preamble
  \ifcase \@chnum 
     \hfil$\relax\displaystyle\@sharp$\hfil \or $\relax\displaystyle\@sharp$\hfil 
    \or \hfil$\relax\displaystyle\@sharp$\fi}}

\def\@wriarrayclassiv{\@addtopreamble{$ \@nextchar$}}
\def\@addtopreamble#1{\edef\@preamble{\@preamble #1}}
\def\@wriarraycr{${\ifnum0=`}\fi\@ifstar{\@wrixarraycr}{\@wrixarraycr}}
\def\@wrixarraycr{\@ifnextchar[{\@argarraycr}{\ifnum0=`{\fi}${}\cr}}
\def\@writabarray{\@ifnextchar[{\@wriarray}{\@wriarray[c]}}
\def\@wriarray[#1]#2{%
	\if#1p \global\allowmathbreaktrue \fi%
    \let\@acol\@wriarrayacol \let\@classz\@wriarrayclassz
    \let\@classiv\@wriarrayclassiv \let\\\@wriarraycr\def\@halignto{}
	\setbox\@arstrutbox=\hbox{\vrule 
     height\arraystretch \ht\strutbox
     depth\arraystretch \dp\strutbox
     width\z@}\@wrimkpream{#2}\edef\@preamble{\halign \noexpand\@halignto
\bgroup \tabskip\z@ \@arstrut \@preamble \tabskip\z@ \cr}%
\let\@startpbox\@@startpbox \let\@endpbox\@@endpbox
  \if #1t \vtop 
  \else \if#1b \vbox 
  \else \if#1p \global\setbox\Mathbox=\vbox
  \else \vcenter \fi\fi\fi
  \bgroup \let\par\relax
  \let\@sharp##\let\protect\relax \lineskip\z@\baselineskip\z@\@preamble}

\def\@wrimkpream#1{\@firstamptrue\@lastchclass6
\def\@preamble{}\def\protect{\noexpand\protect\noexpand}\let\@sharp\relax 
\let\@startpbox\relax\let\@endpbox\relax
\@wriexpast{#1}\expandafter\@writfor \expandafter
  \@nextchar \expandafter:\expandafter=\@tempa\do{\@writestpach\@nextchar
  \ifcase \@chclass \@classz \or \@classi \or \@classii \or \@classiii
    \or \@classiv \or\@classv \fi\@lastchclass\@chclass}%
\ifcase \@lastchclass \@acol
    \or \or \@preamerr \@ne\or \@preamerr \tw@\or \or \@acol \fi}

\def\@wriexpast#1{\@wrixexpast #1*0x\@@}
\def\@wrixexpast#1*#2#3#4\@@{\edef\@tempa{#1}\@tempcnta#2\relax
    \ifnum\@tempcnta >0 \@whilenum\@tempcnta >0\do
       {\edef\@tempa{\@tempa#3}\advance\@tempcnta by \m@ne}\let\@tempb\@wrixexpast
      \else \let\@tempb\@wrixexnoop\fi
    \expandafter\@tempb \@tempa #4\@@}

\def\@writestpach#1{\@chclass \ifnum \@lastchclass=\tw@ 4 \else 
    \ifnum \@lastchclass=3 5 \else
     \z@ \if #1c\@chnum \z@ \else
                              \if #1l\@chnum \@ne \else
                              \if #1r\@chnum \tw@ \else
          \@chclass \if #1|\@ne \else
                    \if #1@\tw@ \else
                    \if #1p3 \else \z@ \@preamerr 0\fi
  \fi  \fi  \fi  \fi  \fi  \fi  
\fi}

\def\@wrixexnoop #1\@@{}
\def\@writfor#1:=#2\do#3{\xdef\@fortmp{#2}\ifx\@fortmp\@empty \else
    \@writforloop#2\@nil\@nil\@@#1{#3}\fi}
\def\@writforloop#1#2\@@#3#4{\def#3{#1}\ifx #3\@nnil 
       \let\@nextwhile=\@fornoop \else
      #4\relax\let\@nextwhile=\@writforloop\fi\@nextwhile#2\@@#3{#4}}

\def\endMathArray{\crcr\egroup\egroup%
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%       Mathematica SESSION macros and settings.                        
%%%%
%%%%       \showprompts
%%%%            Changes notebook.sty's default and shows Input/Output
%%%%            prompts for the Mathematica examples.  By default
%%%%            an automatic prompt counter is used.
%%%%       \noprompts
%%%%            Turns the prompts off
%%%%       \promptfalse
%%%%            Turns off the prompt for only the next example.
%%%%       \NewSession
%%%%            To start a new Mathematica session 
%%%%             (reset the session prompt number to 1.  The
%%%%             prompts are automatically incremented.
%%%%       \MRunrestart
%%%%            Same as \NewSession
%%%%       \setpromptcount{10}
%%%%            To manually set the session prompt counter
%%%%            to "number". 
%%%%       \inprompt{In[5]//TeXForm:=}
%%%%            causes the automatic prompt to be bypassed and
%%%%            instead uses this for the input prompt.  The
%%%%            automatic prompt counter is still incremented.
%%%%            This must be called in the file before the cell 
%%%%            that it is numbering.
%%%%       \outprompt{Out[5]//TeXForm=}
%%%%            same as \inprompt for the output prompt.
%%%%       \promptbreaktrue
%%%%            causes a break right after the prompt so that
%%%%            the input or output rests under the prompt instead
%%%%            of beside it.
%%%%       \setmathindent{0pt}
%%%%            This sets the amount to indent the Input/Output sessions.
%%%%       \aboveinskip=\baselineskip
%%%%            This gives 1 line space above Mathematica inputs
%%%%       \belowinskip=\baselineskip
%%%%            This gives 1 line space below Mathematica inputs
%%%%       \aboveoutskip=.5\baselinskip
%%%%            This gives 1/2 line space above Mathematica outputs
%%%%       \belowoutskip=\baselineskip
%%%%            This gives 1 line space below Mathematica output
%%%%       \let\mathfontsize\footnotesize
%%%%            This sets the size for the Mathematica inputs/outputs
%%%%            to be footnotesize.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcount\promptcount \promptcount = 0
\def\MRunrestart{\global\promptcount = 0}\let\NewSession\MRunrestart
\def\setpromptcount#1{\global\promptcount=#1\global\advance\promptcount -1}
\def\advpromptcount#1{\global\advance\promptcount #1}
\def\inprompt#1{\global\inprompttrue\gdef\INPROMPT{#1}}
\def\outprompt#1{\global\outprompttrue\gdef\OUTPROMPT{#1}}
\def\OUTPROMPT{}\def\INPROMPT{}
\let\Outprompt\outprompt \let\Inprompt\inprompt
\newif\ifinprompt  \newif\ifoutprompt
\newif\ifprompt \promptfalse
\inpromptfalse \outpromptfalse
\newif\ifshowprompts \showpromptsfalse
\def\noprompts{\global\showpromptsfalse\global\promptfalse}
\def\showprompts{\global\showpromptstrue\global\prompttrue}
\showprompts
\newif\ifpromptbreak \promptbreakfalse
\def\In#1{{\italictt #1}}
\def\Inx#1{{\italictt #1}}
\def\Out#1{{\italictt\rule{0pt}{6pt}#1}}
\def\Outx#1{{\italictt #1}}
\newdimen\mathindent \mathindent = 0pt
\def\setmathindent#1{\global\mathindent=#1}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%              INCLUDING EPS GRAPHICS                      %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Use Tom Rokicki's utility to import graphics by default.
\input epsf.sty
%%%%
%%%% Usage:  \mathGraphic{file.eps}
%%%% You can change the width or height of the graphic by
%%%% using \xgraphic and \ygraphic.  Ex:  \xgraphic=3in
%%%% \xgraphic and \ygraphic must be called before the 
%%%% \mathGraphic macro.  Note that changing both can
%%%% change the aspect ratio of the graphic when using epsf.sty.
%%%%
%%%% If you have a nested .tex files, you might want to keep
%%%% some graphics in a different directory than the rest of
%%%% the document.  To make this work, you will need to use
%%%% \graphicdir{/newpath} before the \mathGraphic macro call.
%%%% \graphicdir remains set until another \graphicdir call
%%%% is seen.  The \xgraphic and \ygraphic dimens only effect
%%%% the very next \mathGraphic.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\def\graphicdir#1{\gdef\GRAPHDIR{#1}}
\graphicdir{}
\newdimen\xgraphic \xgraphic=0pt
\newdimen\ygraphic \ygraphic=0pt
\newdimen\defaultwid \defaultwid=0pt
\newdimen\defaultht \defaultht=0pt

\def\setdefaultgrsize#1#2{\global\defaultwid=#1\global\defaultht=#2}

\def\mathGraphic#1{%
	\vskip 1.5\baselineskip plus .25\baselineskip minus .25\baselineskip
	{\parindent 0pt%
	\ifdim\defaultwid > 0pt\epsfxsize\defaultwid\fi
	\ifdim\defaultht > 0pt\epsfxsize\defaultht\fi
	\ifdim\xgraphic > 0pt \epsfxsize\xgraphic\fi
	\ifdim\ygraphic > 0pt \epsfysize\ygraphic\fi
	\global\xgraphic=0pt\global\ygraphic=0pt
	\hbox to \hsize{\hss\epsffile{\GRAPHDIR #1}\hss}}\par
	\vskip 1\baselineskip plus .25\baselineskip minus .25\baselineskip
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\let\nils\nointerlineskip
\newbox\Minbox  \newbox\Moutbox

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% \mathfontsize sets the size of the Mathematica inputs/outputs
%% (default size is \footnotesize)

\global\let\mathfontsize\footnotesize

\catcode`\^^I=13  % make tab a character

{\catcode`\^^M=13 {\catcode`\^^I=13 \catcode`\ =13 %\catcode`\-=13%
\gdef\verbatimdefs{%
\def^^M{\ \par\penalty70\relax}\let =\ \def^^I{        }}}%
\gdef\verbatimgobble#1^^M{}}

\def\mathIn{%
\global\setbox\Moutbox=\hbox{}\gdef\MGRAPHNAME{}%
\global\setbox\Minbox=\vtop\bgroup% 
\parskip 0pt\parindent 0pt\footnotesize\romantt%
\baselineskip 12pt%
\raggedright\nils%\hsize=\rightcom%
\def\do##1{\catcode`##1=12 }\dospecials%
\catcode`\ =13 \catcode`\^^M=13 \catcode`\^^I=13\catcode`\\=0%
\edef\\{\char"5C\relax} \def^^I{\ \ \ \ \ \ \ \ }% Width of "Tab"
\verbatimdefs\verbatimgobble\monospace}

\newif\ifprint \printfalse
\def\mathOut{%
\global\setbox\Moutbox=\vtop\bgroup% 
\parskip 0pt\parindent 0pt\mathfontsize\romantt
\raggedright\nils% 	FONT SIZE/LEADING
\def\do##1{\catcode`##1=12 }\dospecials%
\catcode`\ =13 \catcode`\^^M=13 \catcode`\^^I=13\catcode`\\=0%
\def^^I{\ \ \ \ \ \ \ \ }% Width of "Tab"
\verbatimdefs\verbatimgobble\monospace}


\def\mathText{%
\global\setbox\Moutbox=\vtop\bgroup% 
\parskip 0pt\parindent 0pt\mathfontsize\romantt%
\raggedright\nils% 	FONT SIZE/LEADING
\def\do##1{\catcode`##1=12 }\dospecials%
\catcode`\ =13 \catcode`\^^M=13 \catcode`\^^I=13\catcode`\\=0%
\edef\\{\char"5C\relax} \def^^I{\ \ \ \ \ \ \ \ }% Width of "Tab"
\verbatimdefs\verbatimgobble\monospace}

\catcode`\^^I=10  % make tab other

\def\endmathIn{\par\egroup\vskip-\lastskip\vskip\aboveinskip
		\vskip -\parskip%
	{\romantt\parindent 0pt%
        \ifinprompt%
                \global\advance\promptcount by 1%
                \setbox\@tempboxa=\hbox{\In{\INPROMPT\ \relax}}
                \leavevmode\ifpromptbreak\relax\else\hbox\fi%
					\bgroup\kern\mathindent\In{\INPROMPT\ \relax}%
        \else%
            \ifprompt%
                \global\advance\promptcount by 1%
                \setbox\@tempboxa=\hbox{\kern\mathindent%
					\In{In[\the\promptcount]:= }}%
                \leavevmode\hbox\bgroup\kern\mathindent%
					\In{In[\the\promptcount]:= }%
            \else%
                \setbox\@tempboxa=\hbox{}\leavevmode\hbox\bgroup
                    \mbox{}\kern\mathindent%
            \fi%
        \fi%
			\ifpromptbreak\hfill\break
				\rule{0pt}{7pt}\leavevmode\kern 4pt\fi%
            \vtop{%\baselineskip 12pt%
            \ifpromptbreak\relax\else\advance\hsize -\wd\@tempboxa\fi%
            \copy\Minbox\par}\egroup}%
			%\ifprompt\vskip \baselineskip%
			%\else
			{\ifdim \dp\Minbox > .5\baselineskip\relax \advance\belowinskip by 5pt\fi
			\vskip \belowinskip}
			\global\inpromptfalse\global\promptbreakfalse\global\prompttrue}

\def\endmathOut{\par\egroup\@ifnextchar[{\@setoutdrop}{\@setoutdrop[0]}}
\def\@setoutdrop[#1]{{\romantt\parindent 0pt%
	\vskip-\lastskip\vskip\aboveoutskip\vskip -1pt% Fudge a point for looks%
    \nils\leavevmode\ifpromptbreak\relax\else\hbox{\fi%
    \ifprompt\lower #1\baselineskip\fi%
    \ifoutprompt%
        \hbox{\kern\mathindent\Out{\OUTPROMPT\ \relax}}%
    \else%
        \ifprompt%
            \hbox{\kern\mathindent\Out{Out[\the\promptcount]= }}%
        \else%
            \mbox{}\kern\mathindent%
        \fi%
    \fi%
	\ifpromptbreak\hfill\break%
			\rule{0pt}{7pt}\leavevmode\kern 4pt\fi%
    \vtop{\advance\hsize -\wd\@tempboxa%
        \box\Moutbox\par}\ifpromptbreak\relax\else}\fi
		{\ifdim \dp\Moutbox > .5\baselineskip\relax 
			\advance\belowoutskip by 5pt\fi%
			\vskip \belowoutskip}
}\global\outpromptfalse\global\promptbreakfalse%
	\global\printfalse\global\prompttrue}

\def\endmathText{\par\egroup
	\vskip-\lastskip\vskip\aboveoutskip
    \vtop{\box\Moutbox\par}
    \vskip \belowoutskip}

\let\mathin\mathIn
\let\endmathin\endmathIn
\let\mathout\mathOut
\let\endmathout\endmathOut
\let\mathtext\mathText
\let\endmathtext\endmathText


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%  \fixttmath
%%    makes the alphabetic math atoms come from family 0 (roman) 
%%    instead of family 1.  (Used for creating Mathematica's StandardForm.)
%%    Also redefine some macros to look like Mathematica StandardForm.

\def\mmamathopredefs{%
\def\log{\mathop{\operator@font Log}\nolimits}%
\def\sin{\mathop{\operator@font Sin}\nolimits}%
\def\arcsin{\mathop{\operator@font ArcSin}\nolimits}%
\def\sinh{\mathop{\operator@font Sinh}\nolimits}%
\def\cos{\mathop{\operator@font Cos}\nolimits}%
\def\arccos{\mathop{\operator@font ArcCos}\nolimits}%
\def\cosh{\mathop{\operator@font Cosh}\nolimits}%
\def\tan{\mathop{\operator@font Tan}\nolimits}%
\def\arctan{\mathop{\operator@font ArcTan}\nolimits}%
\def\tanh{\mathop{\operator@font Tanh}\nolimits}%
\def\cot{\mathop{\operator@font Cot}\nolimits}%
\def\coth{\mathop{\operator@font Coth}\nolimits}%
\def\sec{\mathop{\operator@font Sec}\nolimits}%
\def\csc{\mathop{\operator@font Csc}\nolimits}%
\def\max{\mathop{\operator@font Max}}%
\def\min{\mathop{\operator@font Min}}%
\def\arg{\mathop{\operator@font Arg}\nolimits}%
\def\det{\mathop{\operator@font Det}}%
\def\exp{\mathop{\operator@font Exp}\nolimits}%
\def\Pr{\mathop{\operator@font Pr}}%
\def\gcd{\mathop{\operator@font GCD}}%
\def\imag{I}%
}
\def\imag{i}  %% for normal text math

\newskip\aboveinskip \aboveinskip.5\baselineskip plus 4.5pt minus 1pt
\newskip\belowinskip \belowinskip-.01\baselineskip plus 2.5pt minus 1pt
\newskip\aboveoutskip \aboveoutskip.05\baselineskip plus 2.5pt minus 1pt
\newskip\belowoutskip \belowoutskip.01\baselineskip plus 2.5pt minus 1pt

%\newskip\aboveinskip \aboveinskip\baselineskip
%\newskip\belowinskip \belowinskip\baselineskip
%\newskip\aboveoutskip \aboveoutskip .25\baselineskip
%\newskip\belowoutskip \belowoutskip\baselineskip

\newif\ifmatharray \matharrayfalse
\long\def\dispSFinmath{\@ifnextchar[{\dodispSFinmath}{\dodispSFinmath[n]}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%  \dodispSFinmath, \dodispSFoutmath, \dodispTFinmath, \dodispTFoutmath
%%  macros produce Mathematica StandardForm input and output and
%%  TraditionalForm input and output respectively.  All these macros
%%  have similar usage.  Ex:
%%  \dodispSFinmath[p]{2 + 2}
%%  The optional p gives the Mathematica input/output the flexibility to
%%  break across pages if need be.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\long\def\dodispSFinmath[#1]#2{%%
	\vskip-\lastskip
    \if #1p
		\vskip \aboveinskip %
	\else
		\vskip\aboveinskip\global\matharrayfalse
		\global\setbox\Minbox=\vbox
	\fi{\parindent 0pt\mathfontsize%
	\if #1p
		\def\@writabarray{\@ifnextchar[{\@wriarray}{\@wriarray[p]}}
	\else
		\def\@writabarray{\@ifnextchar[{\@wriarray}{\@wriarray[t]}}
		\def\@tabarray{\@ifnextchar[{\@array}{\@array[t]}}
	\fi
	\def\MathBegin##1{\global\matharraytrue%
		\kern -\arraycolsep\def\tempa{\csname ##1\endcsname}\tempa}
	\ifinprompt\global\advance\promptcount by 1%
			\leavevmode\kern\mathindent\In{\INPROMPT\ \relax}%
	\else\ifprompt%
			\global\advance\promptcount by 1%
			\leavevmode%
			\ifpromptbreak%
					\kern\mathindent\In{In[\the\promptcount]:= }\break
					\bgroup\mbox{}\kern\mathindent\kern 12pt
			\else\kern\mathindent\In{In[\the\promptcount]:= }%
			\fi%
       	\else%
			\leavevmode\mbox{}\kern\mathindent%
	\fi\fi%
	\def\Mvariable##1{\mathop{\rm ##1}\nolimits}%
	\let\rm\boldtt\let\it\boldtt\boldttmath $\displaystyle #2$%
	\ifprompt\else\ifshowprompts\global\prompttrue\fi\fi%
	\global\inpromptfalse\global\promptbreakfalse}%
	\if #1p\relax\else\copy\Minbox\fi%
	{\ifmatharray\advance\belowinskip 3pt\global\matharrayfalse\fi%
	\vskip\belowinskip}}

\long\def\dispSFoutmath{\@ifnextchar[{\dodispSFoutmath}{\dodispSFoutmath[n]}}
\def\dispSFDisplayFormulamath#1{\promptfalse\dispSFoutmath{#1}}
\def\dispSFChemicalFormulamath#1{\promptfalse\dispSFoutmath{#1}}
\def\dispSFInlineFormulamath#1{\promptfalse\dispSFoutmath{#1}}
\def\dispSFInlineInputmath#1{\promptfalse\dispSFoutmath{#1}}
\def\dispSFInputOnlymath#1{\promptfalse\dispSFoutmath{#1}}
\def\dispSFNumberedTablemath#1{\dispSFoutmath{#1}}

\long\def\dodispSFoutmath[#1]#2{%%
	\vskip-\lastskip\vskip\aboveoutskip%
	\global\setbox\Moutbox=\vbox
	{\parindent 0pt\mathfontsize%
	\if #1p
		\def\@writabarray{\@ifnextchar[{\@wriarray}{\@wriarray[p]}}
	\else
		\def\@writabarray{\@ifnextchar[{\@wriarray}{\@wriarray[t]}}
		\def\@tabarray{\@ifnextchar[{\@array}{\@array[t]}}
	\fi
	\def\MathBegin##1{\global\matharraytrue%
		\kern -\arraycolsep\def\tempa{\csname ##1\endcsname}\tempa}
	\ifoutprompt%
			\leavevmode\kern\mathindent\Out{\OUTPROMPT\ \relax}%
	\else\ifprompt%
			\leavevmode%
			\ifpromptbreak%
					\kern\mathindent\Out{Out[\the\promptcount]= \relax}\break
					\bgroup\mbox{}\kern\mathindent\kern 12pt
			\else\kern\mathindent\Out{Out[\the\promptcount]= \relax}%
			\fi%
       	\else%
			\leavevmode\mbox{}\kern\mathindent%
	\fi\fi%
	\def\Mvariable##1{\mathop{\rm ##1}\nolimits}%
    \let\rm\romantt\romantt\ttmath$\displaystyle #2$%
	\ifprompt\else\ifshowprompts\global\prompttrue\fi\fi%
	\global\outpromptfalse\global\promptbreakfalse}%
	\if #1p\relax\else\copy\Moutbox\fi%
	{\ifmatharray\advance\belowoutskip 3pt\global\matharrayfalse\fi%
	\vskip\belowoutskip}}


\long\def\dispTFinmath{\@ifnextchar[{\dodispTFinmath}{\dodispTFinmath[n]}}

\long\def\dodispTFinmath[#1]#2{%%
	\vskip-\lastskip%
    \if #1p
		\vskip \aboveinskip %plus .167\baselineskip
	\else
		\vskip\aboveinskip\global\matharrayfalse
		\global\setbox\Minbox=\vbox
	\fi{\parindent 0pt%\wriifundefined{footnotesize}{\relax}{\footnotesize}%
	\mathfontsize%
	\if #1p
		\def\@writabarray{\@ifnextchar[{\@wriarray}{\@wriarray[p]}}
	\else
		\def\@writabarray{\@ifnextchar[{\@wriarray}{\@wriarray[t]}}
		\def\@tabarray{\@ifnextchar[{\@array}{\@array[t]}}
	\fi
	\def\MathBegin##1{\global\matharraytrue%
		\kern -\arraycolsep\def\tempa{\csname ##1\endcsname}\tempa}
	\ifinprompt\global\advance\promptcount by 1%
			\leavevmode\kern\mathindent\In{\INPROMPT\ \relax}%
	\else\ifprompt%
			\global\advance\promptcount by 1%
			\leavevmode%
			\ifpromptbreak%
					\kern\mathindent\In{In[\the\promptcount]:= \relax}\break
					\bgroup\mbox{}\kern\mathindent\kern 12pt
			\else\kern\mathindent\In{In[\the\promptcount]:= \relax}%
			\fi%
       	\else%
			\leavevmode\mbox{}\kern\mathindent%
	\fi\fi%
	\def\Mvariable##1{##1}%
	\boldmath$\displaystyle #2$%
	\ifprompt\else\ifshowprompts\global\prompttrue\fi\fi%
	\global\inpromptfalse\global\promptbreakfalse}%
	\if #1p\relax\else\copy\Minbox\fi\vskip\belowinskip}

\long\def\dispTFoutmath{\@ifnextchar[{\dodispTFoutmath}{\dodispTFoutmath[n]}}
\def\dispTFDisplayFormulamath#1{\promptfalse\dispTFoutmath{#1}}
\def\dispTFChemicalFormulamath#1{\promptfalse\dispTFoutmath{#1}}
\def\dispTFInlineFormulamath#1{\promptfalse\dispTFoutmath{#1}}
\def\dispTFInlineInputmath#1{\promptfalse\dispTFoutmath{#1}}
\def\dispTFInputOnlymath#1{\promptfalse\dispTFoutmath{#1}}
\def\dispTFNumberedTablemath#1{\dispTFoutmath{#1}}

\long\def\dodispTFoutmath[#1]#2{%%
	\vskip-\lastskip\vskip\aboveoutskip%
	\global\setbox\Moutbox=\vbox
	{\parindent 0pt\wriifundefined{footnotesize}{\relax}{\footnotesize}%
	\if #1p
		\def\@writabarray{\@ifnextchar[{\@wriarray}{\@wriarray[p]}}
	\else
		\def\@writabarray{\@ifnextchar[{\@wriarray}{\@wriarray[t]}}
		\def\@tabarray{\@ifnextchar[{\@array}{\@array[t]}}
	\fi
	\def\MathBegin##1{\global\matharraytrue%
		\kern -\arraycolsep\def\tempa{\csname ##1\endcsname}\tempa}
	\ifoutprompt%
			\leavevmode\kern\mathindent\Out{\OUTPROMPT\ \relax}%
	\else\ifprompt%
			\leavevmode%
			\ifpromptbreak%
					\kern\mathindent\Out{Out[\the\promptcount]= \relax}\break
					\bgroup\mbox{}\kern\mathindent\kern 12pt
			\else\kern\mathindent\Out{Out[\the\promptcount]= \relax}%
			\fi%
       	\else%
			\leavevmode\mbox{}\kern\mathindent%
	\fi\fi%
	\def\Mvariable##1{##1}%
	$\displaystyle #2$%
	\ifprompt\else\ifshowprompts\global\prompttrue\fi\fi%
	\global\outpromptfalse\global\promptbreakfalse}%
	\if #1p\relax\else\copy\Moutbox\fi\vskip\belowoutskip}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Don't display Mathematica input inline math bold by default.
%% 	Inline math macros
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\def\inlineinmath#1{$#1$}
\def\inlineoutmath#1{$#1$}
\long\def\inlineSFinmath#1{{\mathversion{monobold}$#1$}}
\long\def\inlineSFoutmath#1{{\mathversion{mono}$#1$}}
\def\inlineSFDisplayFormulamath#1{\inlineSFoutmath{#1}}
\def\inlineSFChemicalFormulamath#1{\inlineSFoutmath{#1}}
\def\inlineSFInlineFormulamath#1{\inlineSFoutmath{#1}}
\def\inlineSFInlineInputmath#1{\inlineSFoutmath{#1}}
\def\inlineSFInputOnlymath#1{\inlineSFoutmath{#1}}
\def\inlineSFNumberedTablemath#1{\inlineSFoutmath{#1}}

\long\def\inlineTFinmath#1{$#1$}
\let\inlineTFoutmath\inlineTFinmath

\def\inlineTFDisplayFormulamath#1{\inlineTFoutmath{#1}}
\def\inlineTFChemicalFormulamath#1{\inlineTFoutmath{#1}}
\def\inlineTFInlineFormulamath#1{\inlineTFoutmath{#1}}
\def\inlineTFInlineInputmath#1{\inlineTFoutmath{#1}}
\def\inlineTFInputOnlymath#1{\inlineTFoutmath{#1}}
\def\inlineTFNumberedTablemath#1{\inlineTFoutmath{#1}}

\let\inlineTFTextmath\inlineSFoutmath
\let\inlineSFTextmath\inlineSFoutmath

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% 	Display math macros  
%%       (always display the display math (input/output cells) as 
%%       Mathematica input/output)  Don't display like a plain math 
%%       equation.  If centered display math is preferred, uncomment
%%     
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\long\def\dispTFmath{\@ifnextchar[{\dodispTFmath}{\dodispTFmath[n]}}
\long\def\dodispTFmath[#1]#2{%
    \if #1p
		\vskip .83\baselineskip plus .167\baselineskip
		\bgroup\par\parindent 0pt%
		\leftskip 0pt plus 1fill\rightskip 0pt plus 1fill
		\def\@writabarray{\@ifnextchar[{\@wriarray}{\@wriarray[p]}}
		\leavevmode
	\else
		\def\@writabarray{\@ifnextchar[{\@wriarray}{\@wriarray[c]}}
		\def\@tabarray{\@ifnextchar[{\@array}{\@array[c]}}
		\global\matharrayfalse
		$$
	\fi
	\def\MathBegin##1{\global\matharraytrue%
		\kern -\arraycolsep\def\tempa{\csname ##1\endcsname}\tempa}
	#2%
	\if #1p\par\egroup\vskip .83\baselineskip plus .167\baselineskip%
	\else$$\fi}

\def\Message#1{\everypar{}\vskip-\lastskip\justaftermathinfalse
	{\parindent 0pt\fixbraces%
	\def\rm{\fam\ttfam\romantt}%
	\ttmath #1\par}\vskip.5\baselineskip}
\let\Print\Message


\long\def\dispSFPrintmath#1{\promptfalse\dispSFoutmath{#1}}
\let\dispTFPrintmath\dispSFPrintmath
\let\dispSFTextmath\dispSFPrintmath
\let\dispTFTextmath\dispSFPrintmath
\let\dispSFMessagemath\dispSFPrintmath
\let\dispTFMessagemath\dispSFPrintmath


\let\mathin\mathIn
\let\endmathin\endmathIn
\let\mathout\mathOut
\let\endmathout\endmathOut
\let\mathtext\mathText
\let\endmathtext\endmathText

\font\romantt=pcrr at 8pt
\font\sromantt=pcrr at 6pt
\font\ssromantt=pcrr at 5pt
\font\italictt=pcrro at 8pt
\font\boldtt=pcrb at 8pt
\font\sboldtt=pcrb at 6pt
\font\ssboldtt=pcrb at 5pt
\font\bolditalictt=pcrbo at 8pt


\newcount\Mcount
\def\setttchar#1{\Mcount=\ttfam \multiply\Mcount by 256
	\advance\Mcount by \the\mathcode#1 \mathcode#1=\Mcount\relax}

\def\newttpos[#1]#2{\Mcount=\ttfam \multiply\Mcount by 256
	\advance\Mcount by #1 \mathcode#2=\Mcount\relax}

\def\boldttmath{%
	\wriifundefined{mib}{%
		\global\font\mib = cmmib8
		\global\font\smib = cmmib6
		\global\font\ssmib = cmmib5
		\global\font\syb = cmbsy8
		\global\font\ssyb = cmbsy6
		\global\font\sssyb = cmbsy5}{}%
	\textfont1\mib \scriptfont1\smib \scriptscriptfont1\ssmib
	\textfont2\syb \scriptfont2\ssyb \scriptscriptfont2\sssyb
	\textfont\ttfam\boldtt \scriptfont\ttfam\sboldtt
		\scriptscriptfont\ttfam\ssboldtt
	\fam\ttfam\boldtt\doTTchars
	\everymath{\fam\ttfam}\everydisplay{\fam\ttfam}%
}	
	
\def\ttmath{%
	\wriifundefined{mi}{%
		\global\font\mi = cmmi8
		\global\font\smi = cmmi6
		\global\font\ssmi = cmmi5
		\global\font\sy = cmsy8
		\global\font\ssy = cmsy6
		\global\font\sssy = cmsy5}{}%
	\textfont1\mi \scriptfont1\smi \scriptscriptfont1\ssmi
	\textfont2\sy \scriptfont2\ssy \scriptscriptfont2\sssy
	\textfont\ttfam\romantt \scriptfont\ttfam\sromantt
		\scriptscriptfont\ttfam\ssromantt
	\fam\ttfam\romantt\doTTchars
	\everymath{\fam\ttfam}\everydisplay{\fam\ttfam}%
}	
\def\doTTchars{%
	\setttchar{`\@}%
	\setttchar{`\!}%
	\setttchar{`\(}%
	\setttchar{`\)}%
	\setttchar{`\+}%
	\setttchar{`\:}%
	\setttchar{`\;}%
	\setttchar{`\=}%
	\setttchar{`\?}%
	\setttchar{`\[}%
	\setttchar{`\\}%
	\setttchar{`\]}%
	\setttchar{`\{}%
	\setttchar{`\}}%
	\newttpos[8234]{`\*}%
	\newttpos[24620]{`\,}%
	\newttpos[46]{`\.}%
	\newttpos[47]{`\/}%
	\newttpos[124]{`\|}%
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Don't display Mathematica input inline math bold by default.
%% 	Inline math macros
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\def\inlineinmath#1{{\def\RawWedge{\hbox{\char'200\relax}}%
	\tt\boldtt\boldttmath\fontdimen3\textfont2=8pt\let\rm\boldtt\let\it\boldtt $#1$}}
\def\inlineoutmath#1{{\def\RawWedge{\hbox{\char'200}\relax}%
	\tt\romantt\ttmath\let\rm\romantt\let\it\romantt $#1$}}
\long\def\inlineSFinmath#1{$#1$}
\long\def\inlineSFoutmath#1{$#1$}
\let\inlineTFinmath\inlineSFinmath
\let\inlineTFoutmath\inlineSFoutmath
\let\inlineTFTextmath\inlineSFoutmath
\let\inlineSFTextmath\inlineSFoutmath


\def\fixbraces{%
	\def\{{\relax\ifmmode\lbrace\else$\lbrace$\fi}%
	\def\}{\relax\ifmmode\rbrace\else$\rbrace$\fi}}


\def\Mfunction#1{\mathop{\rm #1}\nolimits}
\def\Muserfunction#1{\mathop{\rm #1}\nolimits}
\def\Mvariable#1{\mathop{\it #1}\nolimits}
\def\Mstring#1{\mbox{\TSspecialredefs\tt #1}}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%  Macros for Special Cell conversions.  Currently defined to do nothing.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\def\Mspecialone{}
\def\endMspecialone{}
\def\Mspecialtwo{}
\def\endMspecialtwo{}
\def\Mspecialthree{}
\def\endMspecialthree{}
\def\Mspecialfour{}
\def\endMspecialfour{}
\def\Mspecialfive{}
\def\endMspecialfive{}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%  \TeXSaveMessage{the message} - displays message from TeXSave conversion
%%  \noTeXSaveMessages - To turn off messages from the TeXSave conversion
%%  \showTeXSaveMessages - Show messages from the TeXSave conversion
%%                         (\showTeXSaveMessages is the default behavior)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newif\ifshowTSMessage \showTSMessagetrue
\def\noTeXSaveMessages{\showTSMessagefalse}
\def\showTeXSaveMessages{\showTSMessagetrue}

\newwrite\TSwrite
\def\TSoutmessage#1{{\let\protect\string\immediate\write\TSwrite{#1}}}

\long\def\TeXSaveMessage#1{\ifshowTSMessage%
	\TSoutmessage{** TeXSave Message: #1}%
	\errmessage{ TeXSave Message: Hit Return to continue.}\fi}

\global\let\mathfontsize\relax
\newskip\outputskip \outputskip=.7\baselineskip
\def\btt{\tt}

\def\overvar#1#2{\setbox0=\hbox{$#1$}\setbox2=\hbox{$#2$}%
  \dimen1=\ht0\advance\dimen1 .2ex%
  \ifdim\wd0>\wd2\relax%
        \raise\dimen1\hbox to 0pt{\hbox to \wd0{\hss$#2$\hss}\hss}%
                \hbox to \wd0{\hss $#1$\hss}%
        \else\raise\dimen1\hbox to 0pt{$#2$\hss}
                \hbox to \wd2{\hss$#1$\hss}\fi}

\newdimen\figboxrulewt\figboxrulewt=.5pt
\def\figbox#1#2{\vbox{%
        \hrule height \figboxrulewt%
                \hbox{\vrule width \figboxrulewt%
                        \hskip -2\figboxrulewt%
                        \vbox{\vbox to #2{\hbox to #1{\hss}\vss}%
                        \vskip -2\figboxrulewt}%
                \vrule width \figboxrulewt}%
        \hrule height \figboxrulewt}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%  Inline Typewriter font macros

\def\mv#1{\relax\ifmmode\mbox{\tt #1}\else{\tt #1}\fi}
\def\mvi#1{\relax\ifmmode\mbox{\it #1}\else{\it #1}\fi}
\def\mvb#1{\relax\ifmmode\mbox{\tt #1}\else{\tt #1}\fi}
\def\mvbi#1{\relax\ifmmode\mbox{\it #1}\else{\it #1}\fi}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%% Mathematica UNICODE CHARACTER DEFS %%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\def\unknown#1{#1}

\let\Angstrom\AA
\def\CapitalTau{\mathop{\rm T}\nolimits}
\def\circledR{{\ooalign{\hfil\raise .07ex\hbox{R}\hfil\crcr\mathhexbox20D}}}
\let\CounterClockwiseContourIntegral\oint
\def\DifferentialD{d}
\def\DoublePrime{\prime{}\prime}
\def\ExponentialE{e}
\def\FilledCircle{\relax\ifmmode\bullet\else$\bullet$\fi}
\let\FilledSmallCircle\FilledCircle
\def\FilledSquare{\relax%
	\ifmmode\hbox{\raise .3ex\hbox{\vrule height .7ex width .7ex depth 0pt}}%
	\else$\hbox{\raise .3ex\hbox{\vrule height .7ex width .7ex depth 0pt}}$\fi}
\def\hslash{\hbar} % workaround for bogus output from TeXForm
\def\ImaginaryI{I}
\def\ImaginaryJ{I}
\let\InvisiblePrefixScriptBase\relax
\let\InvisibleSpace\relax
\def\LeftBracketingBar{\left|}
\def\LeftDoubleBracket{[[}
\def\LeftDoubleBracketingBar{\relax%
	\ifmmode\hbox{$\parallel$}\else$\parallel$\fi}
\def\LeftSkeleton{\relax\ifmmode <<\else$<<$\fi}
\def\multsp{\>}
\let\Null\relax
\def\NoBreak{\relax\ifmmode\relax\else\nolinebreak\fi}
\def\NonBreakingSpace{\relax\ifmmode\relax\else~\fi}
\def\Placeholder{\figbox{1ex}{1ex}}
\def\RawReturn{\par}
\def\RawTilde{\ifmmode\hbox{\char'176}\else\char'176\relax\fi}
\def\RawUnderscore{\_}
\def\RawWedge{\char'136\relax}
\def\RightBracketingBar{\right|}
\def\RightDoubleBracket{]]}
\let\RightDoubleBracketingBar\LeftDoubleBracketingBar
\def\RightSkeleton{\relax\ifmmode >>\else$>>$\fi}
\def\RuleDelayed{:\rightarrow}
\def\SkeletonIndicator{\relax\ifmmode\hbox{-}\else -\relax\fi}
\def\Square{\relax\ifvmode\leavevmode\fi%
	\raise .4ex\hbox{\vrule height .8ex width .8ex depth 0pt}}
%%  This could conceivably cause problems if \Times is also a font macro.
\let\Times\times 
\def\Trademark{\relax\ifmmode ^{\rm TM}\else$^{\rm TM}$\fi}
\let\Union\bigcup 
\def\VerticalBar{|}
\def\VerticalSeparator{|}

\def\CellGroup{\bgroup}
\def\endCellGroup{\egroup}

%%%%%%%%%%%%%%%%  ACCENTED CHARACTER DEFINITIONS %%%%%%%%%%%%%%%%%%%%%%%%%%%

%% Acute characters %%

\def\AAcute{\'{a}} \def\EAcute{\'{e}} \def\IAcute{\'{i}} \def\OAcute{\'{o}} 
\def\UAcute{\'{u}} \def\CAcute{\'{c}} \def\YAcute{\'{y}}
\def\CapitalAAcute{\'{A}} \def\CapitalEAcute{\'{E}}
\def\CapitalIAcute{\'{I}} \def\CapitalOAcute{\'{O}} \def\CapitalUAcute{\'{U}}
\def\CapitalCAcute{\'{C}} \def\CapitalYAcute{\'{Y}}

%% Grave characters %%

\def\AGrave{\`{a}} \def\EGrave{\`{e}} \def\IGrave{\`{i}} \def\OGrave{\`{o}} 
\def\UGrave{\`{u}} \def\CapitalAGrave{\`{A}} \def\CapitalEGrave{\`{E}}
\def\CapitalIGrave{\`{I}} \def\CapitalOGrave{\`{O}} \def\CapitalUGrave{\`{U}}

%% Umlaut characters %%

\def\ADoubleDot{\"{a}} \def\EDoubleDot{\"{e}} \def\IDoubleDot{\"{i}} \def\ODoubleDot{\"{o}} 
\def\UDoubleDot{\"{u}} \def\CapitalADoubleDot{\"{A}} \def\CapitalEDoubleDot{\"{E}}
\def\CapitalIDoubleDot{\"{I}} \def\CapitalODoubleDot{\"{O}} \def\CapitalUDoubleDot{\"{U}}
\def\YDoubleDot{\"{y}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Still to do:  Tilde, Bar, and Hat accented characters along with Mathematica
%%% characters that cannot be represented in plain TeX or LaTeX.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%  SCRIPT CHARACTER DEFINITIONS  %%%%%%%%%%%%%%%%%%%%%%%%%%%%

\def\ScriptCapitalA{\relax\ifmmode{\cal A}\else${\cal A}$\fi}
\def\ScriptCapitalB{\relax\ifmmode{\cal B}\else${\cal B}$\fi}
\def\ScriptCapitalC{\relax\ifmmode{\cal C}\else${\cal C}$\fi}
\def\ScriptCapitalD{\relax\ifmmode{\cal D}\else${\cal D}$\fi}
\def\ScriptCapitalE{\relax\ifmmode{\cal E}\else${\cal E}$\fi}
\def\ScriptCapitalF{\relax\ifmmode{\cal F}\else${\cal F}$\fi}
\def\ScriptCapitalG{\relax\ifmmode{\cal L}\else${\cal L}$\fi}
\def\ScriptCapitalH{\relax\ifmmode{\cal H}\else${\cal H}$\fi}
\def\ScriptCapitalI{\relax\ifmmode{\cal I}\else${\cal I}$\fi}
\def\ScriptCapitalJ{\relax\ifmmode{\cal J}\else${\cal J}$\fi}
\def\ScriptCapitalK{\relax\ifmmode{\cal K}\else${\cal K}$\fi}
\def\ScriptCapitalL{\relax\ifmmode{\cal L}\else${\cal L}$\fi}
\def\ScriptCapitalM{\relax\ifmmode{\cal M}\else${\cal M}$\fi}
\def\ScriptCapitalN{\relax\ifmmode{\cal N}\else${\cal N}$\fi}
\def\ScriptCapitalO{\relax\ifmmode{\cal O}\else${\cal O}$\fi}
\def\ScriptCapitalP{\relax\ifmmode{\cal P}\else${\cal P}$\fi}
\def\ScriptCapitalQ{\relax\ifmmode{\cal Q}\else${\cal Q}$\fi}
\def\ScriptCapitalR{\relax\ifmmode{\cal R}\else${\cal R}$\fi}
\def\ScriptCapitalS{\relax\ifmmode{\cal S}\else${\cal S}$\fi}
\def\ScriptCapitalT{\relax\ifmmode{\cal T}\else${\cal T}$\fi}
\def\ScriptCapitalU{\relax\ifmmode{\cal U}\else${\cal U}$\fi}
\def\ScriptCapitalV{\relax\ifmmode{\cal V}\else${\cal V}$\fi}
\def\ScriptCapitalW{\relax\ifmmode{\cal W}\else${\cal W}$\fi}
\def\ScriptCapitalX{\relax\ifmmode{\cal X}\else${\cal X}$\fi}
\def\ScriptCapitalY{\relax\ifmmode{\cal Y}\else${\cal Y}$\fi}
\def\ScriptCapitalZ{\relax\ifmmode{\cal Z}\else${\cal Z}$\fi}

\def\ScriptA{\relax\ifmmode a\else{\it a\/}\fi}
\def\ScriptB{\relax\ifmmode b\else{\it b\/}\fi}
\def\ScriptC{\relax\ifmmode c\else{\it c\/}\fi}
\def\ScriptD{\relax\ifmmode d\else{\it d\/}\fi}
\def\ScriptE{\relax\ifmmode e\else{\it e\/}\fi}
\def\ScriptF{\relax\ifmmode f\else{\it f\/}\fi}
\def\ScriptG{\relax\ifmmode g\else{\it g\/}\fi}
\def\ScriptH{\relax\ifmmode h\else{\it h\/}\fi}
\def\ScriptI{\relax\ifmmode i\else{\it i\/}\fi}
\def\ScriptJ{\relax\ifmmode j\else{\it j\/}\fi}
\def\ScriptK{\relax\ifmmode k\else{\it k\/}\fi}
\def\ScriptL{\relax\ifmmode l\else{\it l\/}\fi}
\def\ScriptM{\relax\ifmmode m\else{\it m\/}\fi}
\def\ScriptN{\relax\ifmmode n\else{\it n\/}\fi}
\def\ScriptO{\relax\ifmmode o\else{\it o\/}\fi}
\def\ScriptP{\relax\ifmmode p\else{\it p\/}\fi}
\def\ScriptQ{\relax\ifmmode q\else{\it q\/}\fi}
\def\ScriptR{\relax\ifmmode r\else{\it r\/}\fi}
\def\ScriptS{\relax\ifmmode s\else{\it s\/}\fi}
\def\ScriptT{\relax\ifmmode t\else{\it t\/}\fi}
\def\ScriptU{\relax\ifmmode u\else{\it u\/}\fi}
\def\ScriptV{\relax\ifmmode v\else{\it v\/}\fi}
\def\ScriptW{\relax\ifmmode w\else{\it w\/}\fi}
\def\ScriptX{\relax\ifmmode x\else{\it x\/}\fi}
\def\ScriptY{\relax\ifmmode y\else{\it y\/}\fi}
\def\ScriptZ{\relax\ifmmode z\else{\it z\/}\fi}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% The DoubleStruck and Gothic Characters aren't normally 
%% available to plain TeX and LaTeX2.09, so by default they
%% have been defined to produce just a bold character.
%% If you are using amstex or amslatex, you might wish to 
%% redefine the uppercase DoubleStruck and Gothic macros
%% to take advantage of characters available in the AMS fonts.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\def\DoubleStruckCapitalA{{\bf A}}
\def\DoubleStruckCapitalB{{\bf B}}
\def\DoubleStruckCapitalC{{\bf C}}
\def\DoubleStruckCapitalD{{\bf D}}
\def\DoubleStruckCapitalE{{\bf E}}
\def\DoubleStruckCapitalF{{\bf F}}
\def\DoubleStruckCapitalG{{\bf G}}
\def\DoubleStruckCapitalH{{\bf H}}
\def\DoubleStruckCapitalI{{\bf I}}
\def\DoubleStruckCapitalJ{{\bf J}}
\def\DoubleStruckCapitalK{{\bf K}}
\def\DoubleStruckCapitalL{{\bf L}}
\def\DoubleStruckCapitalM{{\bf M}}
\def\DoubleStruckCapitalN{{\bf N}}
\def\DoubleStruckCapitalO{{\bf O}}
\def\DoubleStruckCapitalP{{\bf P}}
\def\DoubleStruckCapitalQ{{\bf Q}}
\def\DoubleStruckCapitalS{{\bf R}}
\def\DoubleStruckCapitalT{{\bf S}}
\def\DoubleStruckCapitalU{{\bf T}}
\def\DoubleStruckCapitalV{{\bf U}}
\def\DoubleStruckCapitalW{{\bf V}}
\def\DoubleStruckCapitalX{{\bf W}}
\def\DoubleStruckCapitalY{{\bf X}}
\def\DoubleStruckCapitalZ{{\bf Y}}
\def\DoubleStruckCapitalA{{\bf Z}}

\def\DoubleStruckA{{\bf a}}
\def\DoubleStruckB{{\bf b}}
\def\DoubleStruckC{{\bf c}}
\def\DoubleStruckD{{\bf d}}
\def\DoubleStruckE{{\bf e}}
\def\DoubleStruckF{{\bf f}}
\def\DoubleStruckG{{\bf g}}
\def\DoubleStruckH{{\bf h}}
\def\DoubleStruckI{{\bf i}}
\def\DoubleStruckJ{{\bf j}}
\def\DoubleStruckK{{\bf k}}
\def\DoubleStruckL{{\bf l}}
\def\DoubleStruckM{{\bf m}}
\def\DoubleStruckN{{\bf n}}
\def\DoubleStruckO{{\bf o}}
\def\DoubleStruckP{{\bf p}}
\def\DoubleStruckQ{{\bf q}}
\def\DoubleStruckR{{\bf r}}
\def\DoubleStruckS{{\bf s}}
\def\DoubleStruckT{{\bf t}}
\def\DoubleStruckU{{\bf u}}
\def\DoubleStruckV{{\bf v}}
\def\DoubleStruckW{{\bf w}}
\def\DoubleStruckX{{\bf x}}
\def\DoubleStruckY{{\bf y}}
\def\DoubleStruckZ{{\bf z}}

\def\GothicCapitalA{{\bf A}}
\def\GothicCapitalB{{\bf B}}
\def\GothicCapitalC{{\bf C}}
\def\GothicCapitalD{{\bf D}}
\def\GothicCapitalE{{\bf E}}
\def\GothicCapitalF{{\bf F}}
\def\GothicCapitalG{{\bf G}}
\def\GothicCapitalH{{\bf H}}
\def\GothicCapitalI{{\bf I}}
\def\GothicCapitalJ{{\bf J}}
\def\GothicCapitalK{{\bf K}}
\def\GothicCapitalL{{\bf L}}
\def\GothicCapitalM{{\bf M}}
\def\GothicCapitalN{{\bf N}}
\def\GothicCapitalO{{\bf O}}
\def\GothicCapitalP{{\bf P}}
\def\GothicCapitalQ{{\bf Q}}
\def\GothicCapitalS{{\bf R}}
\def\GothicCapitalT{{\bf S}}
\def\GothicCapitalU{{\bf T}}
\def\GothicCapitalV{{\bf U}}
\def\GothicCapitalW{{\bf V}}
\def\GothicCapitalX{{\bf W}}
\def\GothicCapitalY{{\bf X}}
\def\GothicCapitalZ{{\bf Y}}
\def\GothicCapitalA{{\bf Z}}

\def\GothicA{{\bf a}}
\def\GothicB{{\bf b}}
\def\GothicC{{\bf c}}
\def\GothicD{{\bf d}}
\def\GothicE{{\bf e}}
\def\GothicF{{\bf f}}
\def\GothicG{{\bf g}}
\def\GothicH{{\bf h}}
\def\GothicI{{\bf i}}
\def\GothicJ{{\bf j}}
\def\GothicK{{\bf k}}
\def\GothicL{{\bf l}}
\def\GothicM{{\bf m}}
\def\GothicN{{\bf n}}
\def\GothicO{{\bf o}}
\def\GothicP{{\bf p}}
\def\GothicQ{{\bf q}}
\def\GothicR{{\bf r}}
\def\GothicS{{\bf s}}
\def\GothicT{{\bf t}}
\def\GothicU{{\bf u}}
\def\GothicV{{\bf v}}
\def\GothicW{{\bf w}}
\def\GothicX{{\bf x}}
\def\GothicY{{\bf y}}
\def\GothicZ{{\bf z}}


\makeatother
